<?xml version="1.0" encoding="UTF-8"?>
<entityConf xsi:noNamespaceSchemaLocation="../../conf/entityconf.xsd"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" backend="com.ant.crawler.core.ListSiteCrawler">

	<entityFields>
		<rssSite>
		</rssSite>
		<listSite>
			<itemXpath>//div[@class='film']</itemXpath>
			<field xpath="h3/a/@href" name="tempField">
				<filter type="scriptone">
					<![CDATA[
						import com.ant.crawler.core.utils.PrismConstants;
						URL listSite = new URL(conf.get(PrismConstants.PLUGIN_HOME_SITE));
						URL url = new URL(listSite, field);
						field= url.toString();
						entity.setSourceUrl(url); 
						entity.set("source", url.getHost());
						entity.set("create_date", new Date());
						entity.set("owner_email", "tronglongcntt@gmail.com");
						entity.set("parrent", 0);
						entity.set("view", 10);
					]]>
				</filter>
			</field>
		</listSite>
		<detailSite>
			<field xpath="//h2[@class='title_film']/text()" name="title"></field>
			<field xpath="//div[@class='move_info_type']/ul/li[contains(., 'Năm sản xuất')]/a/text()" name="tempField" required="false">
				<filter type="scriptone">
					<![CDATA[
						String title = entity.get("title");
						if (!title.contains(field)) {
							entity.set("title", title  + " (" + field + ")");
						}
					]]>
				</filter>
			</field>
			<field xpath="//img[@class='desc-left']/@src" name="thumbnail"></field>
			<field xpath="//div[@class='move_info_type']/ul/li[contains(., 'Thể loại')]/a/text()" name="tags"  required="false">
				<filter type="scriptone"><![CDATA[
					if (field.equals("Khoa Học Viễn Tưởng")) {
						field = "Viễn Tưởng";
					}
					field = field + ",";
				]]></filter>
				<filter type="scriptall"><![CDATA[
					if (field.length() > 1) {
						field = field.substring(0, field.length() - 1);
						field = field.replace(",\n", ", ");
					}
				]]></filter>
			</field>
			<field
				xpath="//div[@class='move_info_type']/*" name="description"></field>
			<field
				xpath="//video[@id='player2']/source[@type='video/mp4']/@src" name="embed_web">
				<filter type="scriptone"><![CDATA[
					import com.ant.crawler.core.download.Downloader;
					if (!Downloader.isGreaterLength(new URL(field), 52428800)) {
						field = null;
					} else {
						field = "direct*" + field;
					}
				]]></filter>
			</field>
			<field xpath="//video/track/@src" name="tempField1" required="false">
				<filter type="scriptone"><![CDATA[
					import com.ant.crawler.core.download.Downloader;
					import org.apache.commons.io.FileUtils;
					import com.solt.vttconverter.VTTConverter;
					if (field.isEmpty()) {
						return;
					}
					URL subURL = new URL(field);
					String subFile = "/media/thienlong/data/workspace/jee/movie/upload/subtitles/" + Downloader.getRemoteFilename(subURL) + ".vtt";
					String vtt = VTTConverter.tryConvert( new InputStreamReader(subURL.openStream()), false,false);
					FileUtils.writeStringToFile(new File(subFile), vtt);
					entity.set("sub_viet_path", subFile);
				]]></filter>
			</field>
		</detailSite>
	</entityFields>
	<categories mappingField="category_id">
		<category id="1">
			http://phimclub.net/category/phim-le_id93?page=1
			http://phimclub.net/category/phim-le_id93?page=2
			http://phimclub.net/category/phim-le_id93?page=3
			http://phimclub.net/category/phim-le_id93?page=4
			http://phimclub.net/category/phim-le_id93?page=5
			http://phimclub.net/category/phim-le_id93?page=6
			http://phimclub.net/category/phim-le_id93?page=7
			http://phimclub.net/category/phim-le_id93?page=8
			http://phimclub.net/category/phim-le_id93?page=9
		</category>
	</categories>
</entityConf>